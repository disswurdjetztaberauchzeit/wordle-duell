<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Wordle Duell</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
:root{
  --bg:#0a0a0a;--bg2:#141414;--bg3:#1c1c1c;
  --border:#2e2e2e;--border2:#3a3a3a;
  --text:#e8e8e8;--text2:#aaa;--text3:#666;
  --blue:#5aafff;--blue-dim:#0d2240;--blue-border:#2a5a99;
  --pink:#ff7aaa;--pink-dim:#240d1a;--pink-border:#992a5a;
  --green:#3dba52;--green-dim:#0a2210;
  --yellow:#d4920a;--yellow-dim:#221500;
  --red:#ff4455;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:15px}
body{background:var(--bg);color:var(--text);font-family:'Courier New',monospace;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:16px 8px 60px}

/* typography */
.title{font-size:28px;letter-spacing:10px;font-weight:700;background:linear-gradient(90deg,var(--blue),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}
.sub{color:var(--text3);font-size:10px;letter-spacing:4px;margin-top:4px;text-align:center}

/* panels */
.panel{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:24px}

/* buttons */
button{font-family:'Courier New',monospace;cursor:pointer;letter-spacing:1px;transition:all 0.15s;border-radius:5px;border:none;font-size:12px}
.btn{background:var(--bg3);border:1px solid var(--border2);color:var(--text2);padding:9px 18px}
.btn:hover{border-color:#666;color:var(--text)}
.btn-go{background:linear-gradient(135deg,var(--blue-dim),var(--pink-dim));border:1px solid var(--border2);color:var(--text);padding:12px 36px;font-size:13px;letter-spacing:2px}
.btn-go:hover{border-color:#666}
.btn-go:disabled{opacity:0.3;cursor:not-allowed}
.btn-danger{border:1px solid #4a1515;color:var(--red);background:#1a0808;padding:7px 14px;font-size:10px}
.btn-enter{background:var(--green);color:#fff;border:none;border-radius:5px;font-weight:700;font-family:'Courier New',monospace;cursor:pointer;transition:all 0.15s;letter-spacing:1px}
.btn-enter:active{transform:scale(0.95)}

/* inputs */
label{color:var(--text3);font-size:10px;letter-spacing:2px;display:block;margin-bottom:5px;margin-top:14px}
input[type=text],input[type=password],input[type=number]{
  background:var(--bg);border:1px solid var(--border2);color:var(--text);
  border-radius:5px;padding:11px 13px;font-family:'Courier New',monospace;
  font-size:15px;width:100%;outline:none;transition:border-color 0.2s}
input:focus{border-color:#666}
input[type=number]{-moz-appearance:textfield}
input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none}

/* tiles */
.tile{
  width:52px;height:52px;display:flex;align-items:center;justify-content:center;
  font-size:21px;font-weight:700;border-radius:5px;
  border:2px solid var(--border);background:var(--bg2);color:transparent;
  transition:background 0.25s,border-color 0.25s,color 0.15s,transform 0.1s;
  flex-shrink:0;user-select:none}
.tile.mini{width:28px;height:28px;font-size:12px;border-radius:3px;border-width:1px}
.tile.f-a{border-color:var(--blue);background:var(--blue-dim);color:var(--blue)}
.tile.f-b{border-color:var(--pink);background:var(--pink-dim);color:var(--pink)}
.tile.correct{background:var(--green-dim);border-color:var(--green);color:var(--green)}
.tile.present{background:var(--yellow-dim);border-color:var(--yellow);color:var(--yellow)}
.tile.absent{background:#111;border-color:#222;color:#444}
.tile.locked{background:#181818;border-color:#222;color:#555}
.tile.cur-a{box-shadow:0 0 0 2px var(--blue);outline:none}
.tile.cur-b{box-shadow:0 0 0 2px var(--pink);outline:none}
.tile.editable:hover{transform:scale(1.08);cursor:pointer}

/* grid */
.grid{display:flex;flex-direction:column;gap:5px}
.grid-row{display:flex;gap:5px}

/* keyboard */
.keyboard{display:flex;flex-direction:column;gap:5px;margin-top:12px;width:100%}
.kb-row{display:flex;gap:4px;justify-content:center}
.key{
  background:var(--bg3);color:var(--text2);border:1px solid var(--border2);
  border-radius:5px;font-weight:700;height:42px;font-size:13px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;font-family:'Courier New',monospace;
  transition:background 0.15s,color 0.15s;flex-shrink:0;padding:0 4px;min-width:30px}
.key:active{transform:scale(0.92)}
.key.k-del{min-width:44px;font-size:16px}
.key.k-enter{
  min-width:68px;font-size:11px;letter-spacing:1px;
  background:var(--green);color:#fff;border-color:var(--green);font-weight:700}
.key.k-enter:hover{background:#4dca62}
.key.k-correct{background:var(--green-dim);color:var(--green);border-color:var(--green)}
.key.k-present{background:var(--yellow-dim);color:var(--yellow);border-color:var(--yellow)}
.key.k-absent{background:#111;color:#333;border-color:#1a1a1a}

/* play layout */
#play-screen{display:flex;width:100%;max-width:1000px;gap:2px}
.side{flex:1;display:flex;flex-direction:column;align-items:center;padding:14px 10px;border-top:3px solid;min-width:0}
.side-a{background:#080f1c;border-color:var(--blue)}
.side-b{background:#1c080f;border-color:var(--pink)}

/* opponent mini view */
.opp-view{width:100%;margin-bottom:10px;padding:8px;background:rgba(0,0,0,0.3);border-radius:6px;border:1px solid var(--border)}

/* timer */
.timer-wrap{width:100%;margin-bottom:10px}
.timer-bar{height:4px;background:var(--bg3);border-radius:2px;overflow:hidden}
.timer-fill{height:100%;border-radius:2px;transition:width 0.4s linear,background 0.4s}
.timer-lbl{font-size:11px;text-align:right;margin-top:3px;font-weight:700;min-height:15px}

/* toast */
.toast{
  background:var(--bg2);border:1px solid var(--border2);border-radius:5px;
  padding:9px 22px;font-size:12px;color:var(--text);
  margin-bottom:12px;text-align:center;animation:fadeDown 0.2s;
  max-width:500px;width:100%}

/* login step indicator */
.step-dot{width:8px;height:8px;border-radius:50%;background:var(--border2);display:inline-block;margin:0 3px;transition:background 0.3s}
.step-dot.active{background:var(--blue)}

/* stats */
.stat-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid #1a1a1a;font-size:12px}
#admin-panel{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:100;align-items:center;justify-content:center}

/* animations */
@keyframes fadeDown{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
.shake{animation:shake 0.4s}
.dot{display:inline-block;width:7px;height:7px;border-radius:50%;margin:0 2px;animation:pulse 1.3s infinite}

/* mobile */
@media(max-width:660px){
  #play-screen{flex-direction:column}
  .side-b{border-top:2px solid var(--pink)}
  .tile{width:44px;height:44px;font-size:18px}
  .tile.mini{width:22px;height:22px;font-size:9px}
  .key{height:38px;font-size:12px;min-width:26px}
  .key.k-enter{min-width:56px;font-size:10px}
  .key.k-del{min-width:38px}
}
</style>
</head>
<body>

<!-- Header -->
<div style="text-align:center;margin-bottom:16px;width:100%">
  <div class="title">WORDLE DUELL</div>
  <div id="phase-label" class="sub"></div>
</div>
<div id="toast" class="toast" style="display:none"></div>

<!-- QR code â€” always visible -->
<div style="text-align:center;margin-bottom:18px;opacity:0.65">
  <div style="font-size:9px;letter-spacing:3px;color:var(--text3);margin-bottom:8px">MITSPIELEN</div>
  <div id="qrcode" style="display:inline-block;background:#fff;padding:8px;border-radius:6px"></div>
  <div style="font-size:9px;color:var(--text3);margin-top:6px">disswurdjetztaberauchzeit.github.io/wordle-duell</div>
</div>

<!-- â•â• LOGIN A â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-a-screen" style="display:none;width:100%;max-width:420px">
  <div class="panel" style="border-color:var(--blue-border)">
    <div style="color:var(--blue);font-size:11px;letter-spacing:4px;margin-bottom:6px;font-weight:700">SPIELER 1</div>
    <div style="color:var(--text3);font-size:10px;margin-bottom:20px">Gib deinen Namen und die Spieleinstellungen ein.</div>
    <label>DEIN NAME</label>
    <input type="text" id="login-name-a" placeholder="Name..." maxlength="20" onkeydown="if(event.key==='Enter')doLoginA()"/>
    <label>MAX. FEHLVERSUCHE <span style="color:#333">(gilt fÃ¼r beide)</span></label>
    <input type="number" id="login-maxfail" value="6" min="1" max="20"/>
    <label>TIMER PRO ZEILE <span style="color:#333">(Minuten, 0 = kein Timer)</span></label>
    <input type="number" id="login-timer" value="0" min="0" max="30" step="0.5" style="margin-bottom:20px"/>
    <button class="btn-go" style="width:100%" onclick="doLoginA()">WEITER â†’</button>
  </div>
  <div style="text-align:center;margin-top:12px;display:flex;gap:10px;justify-content:center">
    <button class="btn" onclick="showAdmin()">STATISTIK (ADMIN)</button>
    <button class="btn btn-danger" onclick="hardReset(true)">NEUSTART</button>
  </div>
</div>

<!-- â•â• LOGIN B â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-b-screen" style="display:none;width:100%;max-width:420px">
  <div class="panel" style="border-color:var(--pink-border)">
    <div style="color:var(--pink);font-size:11px;letter-spacing:4px;margin-bottom:6px;font-weight:700">SPIELER 2</div>
    <div id="login-b-waiting" style="color:var(--text3);font-size:10px;margin-bottom:20px"></div>
    <label>DEIN NAME</label>
    <input type="text" id="login-name-b" placeholder="Name..." maxlength="20" onkeydown="if(event.key==='Enter')doLoginB()"/>
    <div style="margin-top:20px">
      <button class="btn-go" style="width:100%" onclick="doLoginB()">SPIELEN â†’</button>
    </div>
    <div id="login-b-wait" style="display:none;color:var(--text3);font-size:11px;text-align:center;margin-top:16px;padding:10px">
      <span class="dot" style="background:var(--pink)"></span>
      <span class="dot" style="background:var(--blue);animation-delay:0.4s"></span>
      <span class="dot" style="background:var(--pink);animation-delay:0.8s"></span>
      <div style="margin-top:8px" id="login-b-wait-msg"></div>
    </div>
  </div>
  <div style="text-align:center;margin-top:12px">
    <button class="btn btn-danger" onclick="hardReset(true)">NEUSTART</button>
  </div>
</div>

<!-- â•â• PICK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pick-screen" style="display:none;width:100%;max-width:740px">
  <div style="display:flex;gap:14px;flex-wrap:wrap;justify-content:center">
    <div class="panel" style="border-color:var(--blue-border);min-width:280px;flex:1">
      <div id="pick-title-a" style="color:var(--blue);font-size:10px;letter-spacing:3px;margin-bottom:12px;font-weight:700"></div>
      <div style="color:var(--text3);font-size:10px;margin-bottom:6px">WÃ¶rter komma-getrennt, je 5 Buchstaben (Umlaute erlaubt):</div>
      <input type="text" id="pick-input-a" placeholder="HUNDE, KATZE, GRÃ–SSE..."
        onkeydown="if(event.key==='Enter')submitPick('A')"/>
      <div id="pick-msg-a" style="color:var(--red);font-size:10px;min-height:14px;margin-bottom:8px;margin-top:4px"></div>
      <div id="pick-done-a" style="display:none;color:var(--green);font-size:11px;letter-spacing:2px;text-align:center;padding:10px">âœ… WÃ–RTER GESETZT</div>
      <button class="btn" id="pick-btn-a" style="border-color:var(--blue-border);color:var(--blue);background:var(--blue-dim);width:100%" onclick="submitPick('A')">FESTLEGEN â†’</button>
    </div>
    <div class="panel" style="border-color:var(--pink-border);min-width:280px;flex:1">
      <div id="pick-title-b" style="color:var(--pink);font-size:10px;letter-spacing:3px;margin-bottom:12px;font-weight:700"></div>
      <div style="color:var(--text3);font-size:10px;margin-bottom:6px">WÃ¶rter komma-getrennt, je 5 Buchstaben (Umlaute erlaubt):</div>
      <input type="text" id="pick-input-b" placeholder="HUNDE, KATZE, GRÃ–SSE..."
        onkeydown="if(event.key==='Enter')submitPick('B')"/>
      <div id="pick-msg-b" style="color:var(--red);font-size:10px;min-height:14px;margin-bottom:8px;margin-top:4px"></div>
      <div id="pick-done-b" style="display:none;color:var(--pink);font-size:11px;letter-spacing:2px;text-align:center;padding:10px">âœ… WÃ–RTER GESETZT</div>
      <button class="btn" id="pick-btn-b" style="border-color:var(--pink-border);color:var(--pink);background:var(--pink-dim);width:100%" onclick="submitPick('B')">FESTLEGEN â†’</button>
    </div>
  </div>
  <div style="text-align:center;margin-top:16px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
    <button class="btn btn-danger" onclick="forfeit()">âœ— AUFGEBEN</button>
    <button class="btn" onclick="hardReset(false)">â†º NEUE RUNDE (gleiche Spieler)</button>
    <button class="btn btn-danger" onclick="hardReset(true)">â†º NEUSTART (neue Spieler)</button>
  </div>
</div>

<!-- â•â• PLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="play-screen" style="display:none">

  <!-- SIDE A -->
  <div class="side side-a" id="side-a">
    <!-- My grid (top, big) -->
    <div style="width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <span id="name-a" style="color:var(--blue);font-size:13px;font-weight:700;letter-spacing:3px"></span>
      <span id="att-a" style="color:var(--text3);font-size:11px"></span>
    </div>
    <div class="timer-wrap" id="tw-a" style="display:none">
      <div class="timer-bar"><div class="timer-fill" id="tf-a" style="width:100%"></div></div>
      <div class="timer-lbl" id="tl-a"></div>
    </div>
    <div id="done-a" style="display:none;border-radius:6px;padding:9px 14px;margin-bottom:10px;text-align:center;font-size:12px;letter-spacing:2px;width:100%"></div>
    <div id="grid-a" class="grid"></div>
    <div id="kb-a" class="keyboard"></div>
    <!-- Opponent mini (bottom, small) -->
    <div class="opp-view" style="margin-top:14px">
      <div style="color:var(--text3);font-size:9px;letter-spacing:2px;margin-bottom:6px" id="opp-label-a"></div>
      <div id="mini-b" class="grid"></div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
      <button class="btn btn-danger" onclick="forfeit()">âœ— AUFGEBEN</button>
      <button class="btn" onclick="hardReset(true)">â†º NEUSTART</button>
    </div>
  </div>

  <!-- SIDE B -->
  <div class="side side-b" id="side-b">
    <!-- My grid (top, big) -->
    <div style="width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <span id="name-b" style="color:var(--pink);font-size:13px;font-weight:700;letter-spacing:3px"></span>
      <span id="att-b" style="color:var(--text3);font-size:11px"></span>
    </div>
    <div class="timer-wrap" id="tw-b" style="display:none">
      <div class="timer-bar"><div class="timer-fill" id="tf-b" style="width:100%"></div></div>
      <div class="timer-lbl" id="tl-b"></div>
    </div>
    <div id="done-b" style="display:none;border-radius:6px;padding:9px 14px;margin-bottom:10px;text-align:center;font-size:12px;letter-spacing:2px;width:100%"></div>
    <div id="grid-b" class="grid"></div>
    <div id="kb-b" class="keyboard"></div>
    <!-- Opponent mini (bottom, small) -->
    <div class="opp-view" style="margin-top:14px">
      <div style="color:var(--text3);font-size:9px;letter-spacing:2px;margin-bottom:6px" id="opp-label-b"></div>
      <div id="mini-a" class="grid"></div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
      <button class="btn btn-danger" onclick="forfeit()">âœ— AUFGEBEN</button>
      <button class="btn" onclick="hardReset(true)">â†º NEUSTART</button>
    </div>
  </div>
</div>

<!-- â•â• RESULT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="result-screen" style="display:none;flex-direction:column;align-items:center">
  <div id="winner-text" style="font-size:20px;letter-spacing:6px;font-weight:700;margin-bottom:22px;text-align:center"></div>
  <div id="result-cards" style="display:flex;gap:16px;flex-wrap:wrap;justify-content:center;margin-bottom:24px"></div>
  <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
    <button class="btn-go" onclick="hardReset(false)">NÃ„CHSTE RUNDE â†’</button>
    <button class="btn btn-danger" onclick="hardReset(true)">â†º NEUSTART (neue Spieler)</button>
  </div>
</div>

<!-- â•â• ADMIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="admin-panel">
  <div class="panel" style="border-color:var(--border2);min-width:320px;max-width:560px;width:94%;max-height:88vh;overflow-y:auto">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
      <div style="color:var(--text2);font-size:12px;letter-spacing:4px">STATISTIK</div>
      <button class="btn" onclick="closeAdmin()">âœ•</button>
    </div>
    <div id="admin-login">
      <div style="color:var(--text3);font-size:10px;line-height:1.8;margin-bottom:12px">
        Merksatz: Â»Ich mag Worte, die man nicht aussprechen kann.Â« â€“ Karl Valentin
      </div>
      <input type="password" id="admin-pw" placeholder="Passwort..." onkeydown="if(event.key==='Enter')checkPw()"/>
      <button class="btn" style="width:100%;margin-top:6px" onclick="checkPw()">ENTSPERREN</button>
      <div id="admin-msg" style="color:var(--red);font-size:10px;margin-top:8px;min-height:14px"></div>
    </div>
    <div id="admin-content" style="display:none">
      <div id="stats-list"></div>
      <div style="margin-top:18px;padding-top:14px;border-top:1px solid #1a1a1a;display:flex;gap:10px">
        <button class="btn btn-danger" style="flex:1" onclick="clearStats()">LÃ–SCHEN</button>
        <button class="btn" style="flex:1" onclick="closeAdmin()">SCHLIESSEN</button>
      </div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const db = getFirestore(initializeApp({
  apiKey:"AIzaSyCCMItvN8RNbnWi_V6KdBmhYwFxl53R9R0",
  authDomain:"wordle-duell.firebaseapp.com",
  projectId:"wordle-duell",
  storageBucket:"wordle-duell.firebasestorage.app",
  messagingSenderId:"10346209099",
  appId:"1:10346209099:web:409827941bd01a5b6c12ce"
}));

// Â»Ich mag Worte, die man nicht aussprechen kann.Â« â€“ Karl Valentin
const ADMIN_PW = "Wrglpfrmpft";

// Keyboard rows â€” ENTER on right, DEL left of it (German layout feel)
const KB = [
  ["Q","W","E","R","T","Z","U","I","O","P","Ãœ"],
  ["A","S","D","F","G","H","J","K","L","Ã–","Ã„"],
  ["Y","X","C","V","B","N","M","âŒ«","â†µ"]
];

// Normalize: count umlaut chars as 1 letter each
function wordLen(w){ return [...w].length; }
function validWord(w){
  const clean = w.trim().toUpperCase();
  return wordLen(clean) === 5 && /^[A-ZÃ„Ã–ÃœÃŸ]+$/.test(clean);
}
function normalizeInput(s){
  // uppercase, keep umlauts
  return s.toUpperCase().replace(/SS/g,"ÃŸ").replace(/[^A-ZÃ„Ã–ÃœÃŸ]/g,"");
}

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let ST=null, myRole=null, adminOpen=false, unsub=null, timerIv=null;
// Local input state per side
let inp={A:"",B:""}, cur={A:0,B:0};

function fresh(){
  return{
    phase:"login-a",
    nameA:"",nameB:"",
    maxFail:6,timerMin:0,
    wordListA:[],wordListB:[],
    wordIdxA:0,wordIdxB:0,
    pickedA:false,pickedB:false,
    histA:[],histB:[],
    doneA:false,wonA:false,
    doneB:false,wonB:false,
    forfeitBy:"",
    rowStartA:null,rowStartB:null,
    lockedRowA:-1,lockedRowB:-1  // row locked by timer
  };
}

async function fsR(p){const[c,i]=p.split("/");const s=await getDoc(doc(db,c,i));return s.exists()?s.data():null;}
async function fsW(p,d){const[c,i]=p.split("/");await setDoc(doc(db,c,i),d);}

function sub(){
  if(unsub)unsub();
  unsub=onSnapshot(doc(db,"duel","state"),snap=>{
    ST=snap.exists()?snap.data():fresh();
    if(!snap.exists())fsW("duel/state",ST);
    render();
  });
}

// â”€â”€ Login A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doLoginA=async function(){
  const name=el("login-name-a").value.trim();
  const mf=parseInt(el("login-maxfail").value)||6;
  const tm=parseFloat(el("login-timer").value)||0;
  if(!name){toast("Bitte Namen eingeben");return;}
  myRole="A";
  await fsW("duel/state",{...fresh(),phase:"login-b",nameA:name,maxFail:mf,timerMin:tm});
};

// â”€â”€ Login B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doLoginB=async function(){
  const name=el("login-name-b").value.trim();
  if(!name){toast("Bitte Namen eingeben");return;}
  if(!ST||!ST.nameA){toast("Warte auf Spieler 1");return;}
  myRole="B";
  el("login-b-wait").style.display="block";
  el("login-b-wait-msg").textContent=name+" tritt bei...";
  // Merge: take player A's maxFail/timer settings (set by A)
  await fsW("duel/state",{...ST,phase:"pick",nameB:name});
};

// â”€â”€ Hard reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.hardReset=async function(fullReset){
  const msg=fullReset?"Neustart? Beide Spieler mÃ¼ssen sich neu anmelden.":"Neue Runde? WÃ¶rter werden neu gewÃ¤hlt.";
  if(!confirm(msg))return;
  myRole=null;inp={A:"",B:""};cur={A:0,B:0};stopTimer();
  if(fullReset){await fsW("duel/state",fresh());}
  else{
    const s=fresh();
    s.nameA=ST.nameA||"";s.nameB=ST.nameB||"";
    s.maxFail=ST.maxFail||6;s.timerMin=ST.timerMin||0;
    s.phase="pick";
    await fsW("duel/state",s);
  }
};

// â”€â”€ Pick â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.submitPick=async function(player){
  const raw=el("pick-input-"+player.toLowerCase()).value;
  const msgEl=el("pick-msg-"+player.toLowerCase());
  // Split on comma, normalize each word
  const words=raw.split(",").map(w=>[...w.trim().toUpperCase()].filter(c=>/[A-ZÃ„Ã–ÃœÃŸ]/.test(c)).join("")).filter(w=>w.length>0);
  const invalid=words.filter(w=>wordLen(w)!==5);
  if(!words.length){msgEl.textContent="Mindestens ein 5-Buchstaben-Wort eingeben";return;}
  if(invalid.length){msgEl.textContent="Nicht 5 Buchstaben: "+invalid.join(", ");return;}
  msgEl.textContent="";
  const now=Date.now();
  const upd={...ST};
  if(player==="A"){upd.wordListA=words;upd.pickedA=true;}
  else{upd.wordListB=words;upd.pickedB=true;}
  if(upd.pickedA&&upd.pickedB){
    Object.assign(upd,{phase:"play",histA:[],histB:[],doneA:false,wonA:false,doneB:false,wonB:false,wordIdxA:0,wordIdxB:0,forfeitBy:"",rowStartA:now,rowStartB:now,lockedRowA:-1,lockedRowB:-1});
    inp={A:"",B:""};cur={A:0,B:0};
  }
  await fsW("duel/state",upd);
};

// â”€â”€ Forfeit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.forfeit=async function(){
  if(!confirm("Wirklich aufgeben?"))return;
  const upd={...ST,forfeitBy:myRole||"?",phase:"result",doneA:true,doneB:true};
  if(myRole==="A"){upd.wonA=false;upd.wonB=true;}else{upd.wonB=false;upd.wonA=true;}
  await fsW("duel/state",upd);
  await saveResult(upd);
};

// â”€â”€ Wordle evaluate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function evaluate(guess,target){
  const g=[...guess],t=[...target];
  const res=Array(5).fill("absent");
  g.forEach((c,i)=>{if(c===t[i]){res[i]="correct";t[i]=null;g[i]=null;}});
  g.forEach((c,i)=>{if(!c)return;const ti=t.indexOf(c);if(ti!==-1){res[i]="present";t[ti]=null;}});
  return res;
}
function kbState(letter,hist){
  let best="unused";
  for(const row of hist){[...row.word].forEach((c,i)=>{if(c!==letter)return;const s=row.states[i];if(s==="correct")best="correct";else if(s==="present"&&best!=="correct")best="present";else if(s==="absent"&&best==="unused")best="absent";});}
  return best;
}

// â”€â”€ Insert at cursor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function insertAt(str,pos,ch){
  const arr=[...("     ")].map((_,i)=>[...str][i]||" ");
  arr[pos]=ch;
  return arr.join("").replace(/ +$/,"");
}

// â”€â”€ Tile click (cursor) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.tileCk=function(player,pos){cur[player]=pos;render();};

// â”€â”€ Submit guess â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function submitGuess(player){
  if(!ST||ST.phase!=="play")return;
  if(player==="A"?ST.doneA:ST.doneB)return;
  const locked=player==="A"?ST.lockedRowA:ST.lockedRowB;
  const histLen=player==="A"?ST.histA.length:ST.histB.length;
  if(locked===histLen)return; // current row locked by timer
  const word=inp[player];
  const wlist=player==="A"?ST.wordListB:ST.wordListA;
  const widx=player==="A"?ST.wordIdxA:ST.wordIdxB;
  const target=wlist[widx%wlist.length];
  const maxF=ST.maxFail||6;
  if(wordLen(word)!==5){shake(player);toast("5 Buchstaben nÃ¶tig");return;}
  const states=evaluate([...word],[...target]);
  const won=[...word].join("")===[...target].join("");
  const now=Date.now();
  const upd={...ST,histA:[...ST.histA],histB:[...ST.histB]};
  if(player==="A"){
    upd.histA.push({word,states});upd.rowStartA=now;upd.lockedRowA=-1;
    if(won&&upd.wordIdxA+1<wlist.length){upd.wordIdxA++;upd.histA=[];}
    else if(won||upd.histA.length>=maxF){upd.doneA=true;upd.wonA=won;}
    inp.A="";cur.A=0;
  }else{
    upd.histB.push({word,states});upd.rowStartB=now;upd.lockedRowB=-1;
    if(won&&upd.wordIdxB+1<wlist.length){upd.wordIdxB++;upd.histB=[];}
    else if(won||upd.histB.length>=maxF){upd.doneB=true;upd.wonB=won;}
    inp.B="";cur.B=0;
  }
  if(upd.doneA&&upd.doneB){upd.phase="result";await fsW("duel/state",upd);await saveResult(upd);}
  else await fsW("duel/state",upd);
}

function shake(player){
  const gridEl=el("grid-"+player.toLowerCase());
  const hist=player==="A"?ST.histA:ST.histB;
  const row=gridEl&&gridEl.querySelectorAll(".grid-row")[hist.length];
  if(row){row.classList.add("shake");setTimeout(()=>row.classList.remove("shake"),400);}
}

// â”€â”€ Timer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function stopTimer(){if(timerIv){clearInterval(timerIv);timerIv=null;}}

function startTimer(){
  stopTimer();
  timerIv=setInterval(async()=>{
    if(!ST||ST.phase!=="play")return;
    const tm=ST.timerMin||0;
    for(const p of["A","B"]){
      const fill=el("tf-"+p.toLowerCase());
      const lbl=el("tl-"+p.toLowerCase());
      const wrap=el("tw-"+p.toLowerCase());
      if(!fill||!lbl||!wrap)continue;
      if(!tm||tm<=0){wrap.style.display="none";continue;}
      wrap.style.display="block";
      const done=p==="A"?ST.doneA:ST.doneB;
      const histLen=p==="A"?ST.histA.length:ST.histB.length;
      const locked=p==="A"?ST.lockedRowA:ST.lockedRowB;
      if(done||locked===histLen){fill.style.width="0%";lbl.textContent="";continue;}
      const startTs=p==="A"?ST.rowStartA:ST.rowStartB;
      if(!startTs)continue;
      const totalMs=tm*60000;
      const elapsed=Date.now()-startTs;
      const remaining=Math.max(0,totalMs-elapsed);
      const pct=(remaining/totalMs)*100;
      const secs=Math.ceil(remaining/1000);
      const m=Math.floor(secs/60),s=secs%60;
      const col=pct>60?"var(--green)":pct>25?"var(--yellow)":"var(--red)";
      fill.style.width=pct+"%";fill.style.background=col;
      lbl.style.color=col;
      lbl.textContent=(m>0?m+"m ":"")+s+"s";
      // Time's up â€” only act for my role
      if(elapsed>=totalMs&&myRole===p){
        // Lock this row: fill with dashes, advance
        const upd={...ST,histA:[...ST.histA],histB:[...ST.histB]};
        const lockRow=histLen;
        const wlist=p==="A"?ST.wordListB:ST.wordListA;
        const widx=p==="A"?ST.wordIdxA:ST.wordIdxB;
        const target=wlist[widx%wlist.length];
        const dashes=[...target].map(()=>"â€”").join("");
        const states=Array(5).fill("absent");
        const now=Date.now();
        if(p==="A"){
          upd.histA.push({word:dashes,states,locked:true});
          upd.rowStartA=now;upd.lockedRowA=-1;
          if(upd.histA.length>=(upd.maxFail||6)){upd.doneA=true;upd.wonA=false;}
          inp.A="";cur.A=0;
        }else{
          upd.histB.push({word:dashes,states,locked:true});
          upd.rowStartB=now;upd.lockedRowB=-1;
          if(upd.histB.length>=(upd.maxFail||6)){upd.doneB=true;upd.wonB=false;}
          inp.B="";cur.B=0;
        }
        if(upd.doneA&&upd.doneB){upd.phase="result";await fsW("duel/state",upd);await saveResult(upd);}
        else await fsW("duel/state",upd);
      }
    }
  },400);
}

// â”€â”€ Physical keyboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Each side only controlled from its own panel (click to focus)
let focusedSide=null;
function focusSide(p){focusedSide=p;}

document.addEventListener("keydown",e=>{
  const p=focusedSide||myRole;
  if(!p||adminOpen||!ST||ST.phase!=="play")return;
  if(p==="A"?ST.doneA:ST.doneB)return;
  const histLen=p==="A"?ST.histA.length:ST.histB.length;
  const locked=p==="A"?ST.lockedRowA:ST.lockedRowB;
  if(locked===histLen)return;
  const pos=cur[p];
  if(e.key==="Enter"){submitGuess(p);return;}
  if(e.key==="Backspace"){
    const arr=[...((inp[p]||"")+"     ")].slice(0,5);
    arr.splice(pos,1);arr.push(" ");
    inp[p]=arr.join("").replace(/ +$/,"");
    cur[p]=Math.max(0,pos-1);
    render();return;
  }
  let k=e.key.length===1?e.key.toUpperCase():null;
  if(k&&/^[A-ZÃ„Ã–ÃœÃŸ]$/.test(k)){
    inp[p]=insertAt(inp[p]||"",pos,k);
    cur[p]=Math.min(4,pos+1);
    render();
  }
});

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  if(!ST)return;
  const labels={"login-a":"ANMELDEN","login-b":"ANMELDEN","pick":"WÃ–RTER WÃ„HLEN","play":"DUELL","result":"ERGEBNIS"};
  el("phase-label").textContent=labels[ST.phase]||"";
  D("login-a-screen",ST.phase==="login-a");
  D("login-b-screen",ST.phase==="login-b");
  D("pick-screen",   ST.phase==="pick");
  D("play-screen",   ST.phase==="play","flex");
  D("result-screen", ST.phase==="result","flex");
  if(ST.phase==="login-a")rLoginA();
  if(ST.phase==="login-b")rLoginB();
  if(ST.phase==="pick")   rPick();
  if(ST.phase==="play")  {rPlay();startTimer();}
  if(ST.phase==="result"){rResult();stopTimer();}
}

function rLoginA(){/* nothing dynamic */}

function rLoginB(){
  if(ST.nameA){
    el("login-b-waiting").textContent=ST.nameA+" hat das Spiel gestartet. Gib deinen Namen ein:";
  }
}

function rPick(){
  const nA=ST.nameA||"Spieler A",nB=ST.nameB||"Spieler B";
  el("pick-title-a").textContent=nA.toUpperCase()+" WÃ„HLT FÃœR "+nB.toUpperCase();
  el("pick-title-b").textContent=nB.toUpperCase()+" WÃ„HLT FÃœR "+nA.toUpperCase();
  if(ST.pickedA){D("pick-done-a",true);D("pick-btn-a",false);}
  if(ST.pickedB){D("pick-done-b",true);D("pick-btn-b",false);}
}

function rPlay(){
  const nA=ST.nameA||"A",nB=ST.nameB||"B";
  el("name-a").textContent=nA.toUpperCase();
  el("name-b").textContent=nB.toUpperCase();
  el("opp-label-a").textContent=nB.toUpperCase()+" RATET...";
  el("opp-label-b").textContent=nA.toUpperCase()+" RATET...";
  const maxF=ST.maxFail||6;
  const wlA=ST.wordListB||[],wlB=ST.wordListA||[];
  const tA=wlA[(ST.wordIdxA||0)%wlA.length]||"?????";
  const tB=wlB[(ST.wordIdxB||0)%wlB.length]||"?????";
  let aA=ST.histA.length+"/"+maxF,aB=ST.histB.length+"/"+maxF;
  if(wlA.length>1)aA+=" Â· "+((ST.wordIdxA||0)+1)+"/"+wlA.length;
  if(wlB.length>1)aB+=" Â· "+((ST.wordIdxB||0)+1)+"/"+wlB.length;
  el("att-a").textContent=aA;
  el("att-b").textContent=aB;
  el("tw-a").style.display=(ST.timerMin>0)?"block":"none";
  el("tw-b").style.display=(ST.timerMin>0)?"block":"none";
  rMainGrid("grid-a",ST.histA,inp.A,cur.A,tA,"A",maxF);
  rMainGrid("grid-b",ST.histB,inp.B,cur.B,tB,"B",maxF);
  rMiniGrid("mini-a",ST.histA,"A");
  rMiniGrid("mini-b",ST.histB,"B");
  rDone("done-a",ST.doneA,ST.wonA,tA,"A");
  rDone("done-b",ST.doneB,ST.wonB,tB,"B");
  rKB("kb-a",ST.histA,"A");
  rKB("kb-b",ST.histB,"B");
}

function rMainGrid(id,hist,input,cursor,target,player,maxF){
  const container=el(id);container.innerHTML="";
  const done=player==="A"?ST.doneA:ST.doneB;
  const lockedRow=player==="A"?ST.lockedRowA:ST.lockedRowB;
  const rows=Math.max(maxF,hist.length+(done?0:1));
  for(let r=0;r<rows;r++){
    const row=document.createElement("div");row.className="grid-row";
    const committed=r<hist.length,current=r===hist.length&&!done;
    const isLocked=committed&&hist[r].locked;
    const word=committed?hist[r].word:current?input:"";
    const letters=[...word];
    const states=committed?hist[r].states:null;
    for(let c=0;c<5;c++){
      const t=document.createElement("div");t.className="tile";
      const ch=letters[c]||"";t.textContent=ch;
      if(committed){
        if(isLocked)t.classList.add("locked");
        else t.classList.add(states[c]);
      }else if(current){
        if(ch)t.classList.add("f-"+player.toLowerCase());
        if(c===cursor&&!done)t.classList.add("cur-"+player.toLowerCase());
        t.classList.add("editable");
        const cc=c;
        t.addEventListener("click",e=>{e.stopPropagation();cur[player]=cc;render();});
      }
      row.appendChild(t);
    }
    container.appendChild(row);
  }
}

function rMiniGrid(id,hist,player){
  const container=el(id);container.innerHTML="";
  for(let r=0;r<6;r++){
    const row=document.createElement("div");row.style.cssText="display:flex;gap:3px;margin-bottom:3px";
    const committed=r<hist.length;
    for(let c=0;c<5;c++){
      const t=document.createElement("div");t.className="tile mini";
      if(committed){
        if(hist[r].locked)t.classList.add("locked");
        else t.classList.add(hist[r].states[c]);
      }
      row.appendChild(t);
    }
    container.appendChild(row);
  }
}

function rDone(id,done,won,word,player){
  const e=el(id);
  if(!done){e.style.display="none";return;}
  e.style.display="block";
  const col=player==="A"?"var(--blue)":"var(--pink)";
  e.style.background=won?"var(--green-dim)":"#1a0808";
  e.style.border=won?"1px solid var(--green)":"1px solid var(--red)";
  e.style.color=won?"var(--green)":"var(--red)";
  e.innerHTML=won?"âœ“ GELÃ–ST!":"âœ— NICHT GELÃ–ST â€” Wort: <span style='color:"+col+";font-family:monospace'>"+word+"</span>";
}

function rKB(id,hist,player){
  const container=el(id);container.innerHTML="";
  const done=player==="A"?ST.doneA:ST.doneB;
  const histLen=player==="A"?ST.histA.length:ST.histB.length;
  const locked=player==="A"?ST.lockedRowA:ST.lockedRowB;
  if(done)return;
  KB.forEach(row=>{
    const rowEl=document.createElement("div");rowEl.className="kb-row";
    row.forEach(k=>{
      const btn=document.createElement("button");
      const isEnter=k==="â†µ",isDel=k==="âŒ«";
      if(isEnter){btn.className="btn-enter key k-enter";btn.style.cssText="min-width:68px;height:42px;font-size:11px;letter-spacing:1px";}
      else if(isDel){btn.className="key k-del";}
      else{
        btn.className="key";
        const ks=kbState(k,hist);
        if(ks!=="unused")btn.classList.add("k-"+ks);
      }
      btn.textContent=k==="â†µ"?"ENTER":k;
      btn.addEventListener("click",e=>{
        e.stopPropagation();
        focusSide(player);
        if(locked===histLen)return;
        const pos=cur[player];
        const cur2=inp[player]||"";
        if(isEnter){submitGuess(player);}
        else if(isDel){
          const arr=[...(cur2+"     ")].slice(0,5);
          arr.splice(pos,1);arr.push(" ");
          inp[player]=arr.join("").replace(/ +$/,"");
          cur[player]=Math.max(0,pos-1);
          render();
        }else if(/^[A-ZÃ„Ã–ÃœÃŸ]$/.test(k)){
          inp[player]=insertAt(cur2,pos,k);
          cur[player]=Math.min(4,pos+1);
          render();
        }
      });
      rowEl.appendChild(btn);
    });
    container.appendChild(rowEl);
  });
}

function rResult(){
  const s=ST;
  const attA=s.histA&&s.histA.length||0,attB=s.histB&&s.histB.length||0;
  let winner="";
  if(s.forfeitBy)winner=s.forfeitBy==="A"?s.nameB:s.nameA;
  else if(s.wonA&&!s.wonB)winner=s.nameA;
  else if(s.wonB&&!s.wonA)winner=s.nameB;
  else if(s.wonA&&s.wonB)winner=attA<=attB?s.nameA:s.nameB;
  const isA=winner===s.nameA;
  const wt=el("winner-text");
  wt.innerHTML=winner
    ?"<span style='color:"+(isA?"var(--blue)":"var(--pink)")+"'>"+winner.toUpperCase()+" GEWINNT! ğŸ†</span>"
    :"<span style='color:var(--yellow)'>UNENTSCHIEDEN</span>";
  if(s.forfeitBy)wt.innerHTML+="<div style='color:var(--text3);font-size:11px;margin-top:8px;letter-spacing:2px'>durch Aufgabe</div>";
  const cards=el("result-cards");cards.innerHTML="";
  [[s.nameA||"A","var(--blue)","var(--blue-border)",s.wonA,attA,s.wordListB&&s.wordListB[s.wordIdxA]||"?????"],
   [s.nameB||"B","var(--pink)","var(--pink-border)",s.wonB,attB,s.wordListA&&s.wordListA[s.wordIdxB]||"?????"]].forEach(([name,col,dim,won,att,word])=>{
    const isW=winner===name;
    const d=document.createElement("div");
    d.style.cssText="background:var(--bg2);border:1px solid "+(isW?col:dim)+";border-radius:10px;padding:22px 28px;text-align:center;min-width:165px;"+(isW?"box-shadow:0 0 30px "+col.replace("var(--blue)","#5aafff44").replace("var(--pink)","#ff7aaa44"):"");
    d.innerHTML=(isW?"<div style='font-size:24px;margin-bottom:8px'>ğŸ†</div>":"")
      +"<div style='color:"+col+";font-size:11px;letter-spacing:4px;margin-bottom:10px'>"+name.toUpperCase()+"</div>"
      +"<div style='color:var(--text);font-size:32px;font-weight:700;font-family:monospace'>"+att+"</div>"
      +"<div style='color:var(--text3);font-size:10px;letter-spacing:2px;margin-bottom:10px'>VERSUCHE</div>"
      +"<div style='color:"+(won?"var(--green)":"var(--red)")+";font-size:12px;letter-spacing:2px'>"+(won?"âœ“ GELÃ–ST":"âœ— NICHT GELÃ–ST")+"</div>"
      +"<div style='color:var(--text3);font-size:10px;margin-top:8px'>Wort: <span style='color:"+col+";font-family:monospace'>"+word+"</span></div>";
    cards.appendChild(d);
  });
}

// â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function saveResult(s){
  const attA=s.histA&&s.histA.length||0,attB=s.histB&&s.histB.length||0;
  let winner="";
  if(s.forfeitBy)winner=s.forfeitBy==="A"?s.nameB:s.nameA;
  else if(s.wonA&&!s.wonB)winner=s.nameA;
  else if(s.wonB&&!s.wonA)winner=s.nameB;
  else if(s.wonA&&s.wonB)winner=attA<=attB?s.nameA:s.nameB;
  const e={date:new Date().toLocaleDateString("de-DE"),time:new Date().toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),playerA:s.nameA||"A",playerB:s.nameB||"B",attemptsA:attA,attemptsB:attB,wonA:!!s.wonA,wonB:!!s.wonB,forfeit:s.forfeitBy||"",winner};
  const cur=await fsR("duel/stats")||{games:[]};
  cur.games=[...(cur.games||[]),e];
  await fsW("duel/stats",cur);
}

window.showAdmin=function(){adminOpen=true;el("admin-panel").style.display="flex";el("admin-login").style.display="block";el("admin-content").style.display="none";el("admin-msg").textContent="";el("admin-pw").value="";};
window.closeAdmin=function(){adminOpen=false;el("admin-panel").style.display="none";};
window.checkPw=async function(){
  if(el("admin-pw").value===ADMIN_PW){el("admin-login").style.display="none";el("admin-content").style.display="block";await loadStats();}
  else el("admin-msg").textContent="Falsches Passwort";
};
async function loadStats(){
  const data=await fsR("duel/stats");const games=data&&data.games||[];
  const list=el("stats-list");
  if(!games.length){list.innerHTML="<div style='color:var(--text3);font-size:12px;text-align:center;padding:16px'>Noch keine Spiele</div>";return;}
  list.innerHTML="<div style='color:var(--text3);font-size:10px;letter-spacing:2px;margin-bottom:12px'>"+games.length+" SPIELE</div>"
    +[...games].reverse().map(g=>"<div class='stat-row'><div><div style='color:var(--text);font-size:12px'>"+g.date+" "+g.time+"</div><div style='color:var(--text3);font-size:10px;margin-top:2px'>"+g.playerA+" vs "+g.playerB+"</div></div><div style='text-align:right'><div style='color:"+(g.winner===g.playerA?"var(--blue)":"var(--pink)")+";font-size:12px;font-weight:700'>"+(g.winner||"â€”")+"</div><div style='color:var(--text3);font-size:10px'>"+g.attemptsA+" : "+g.attemptsB+" Versuche</div>"+(g.forfeit?"<div style='color:var(--red);font-size:9px;margin-top:2px'>Aufgabe</div>":"")+"</div></div>").join("");
}
window.clearStats=async function(){if(!confirm("Wirklich lÃ¶schen?"))return;await fsW("duel/stats",{games:[]});await loadStats();};

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function el(id){return document.getElementById(id);}
function D(id,show,disp){const e=el(id);if(e)e.style.display=show?(disp||"block"):"none";}
function toast(m,d){const e=el("toast");e.textContent=m;e.style.display="block";clearTimeout(e._t);e._t=setTimeout(()=>e.style.display="none",d||2500);}

// â”€â”€ QR Code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setTimeout(()=>{
  try{new QRCode(el("qrcode"),{text:"https://disswurdjetztaberauchzeit.github.io/wordle-duell/",width:120,height:120,colorDark:"#111",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.M});}
  catch(e){console.warn("QR:",e);}
},300);

// â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Side panels focus tracking
["side-a","side-b"].forEach(id=>{
  const e=el(id);
  if(e)e.addEventListener("click",()=>focusSide(id==="side-a"?"A":"B"));
});

sub();
</script>
</body>
</html>
