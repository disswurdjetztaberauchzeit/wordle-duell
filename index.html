<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Wordle Duell</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:#080808;color:#ccc;font-family:'Courier New',monospace;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px 10px}
.vs-title{font-size:26px;letter-spacing:10px;font-weight:700;background:linear-gradient(90deg,#4a9eff,#ff6b8a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}
.subtitle{color:#555;font-size:11px;letter-spacing:4px;margin-top:4px;text-align:center}
.panel{background:#0a0a0a;border:1px solid #1a1a1a;border-radius:8px;padding:24px}
button{font-family:'Courier New',monospace;cursor:pointer;letter-spacing:2px;transition:all 0.2s;border-radius:4px}
.btn{background:transparent;border:1px solid #333;color:#888;font-size:11px;padding:9px 20px}
.btn:hover{border-color:#555;color:#ccc}
.btn-a{border-color:#1a3a6a;color:#4a9eff;background:#060d1a}
.btn-b{border-color:#6a1a2a;color:#ff6b8a;background:#1a060d}
.btn-go{background:linear-gradient(90deg,#1a3a6a,#6a1a2a);border:1px solid #555;color:#fff;padding:11px 36px;font-size:12px}
.btn-go:disabled{opacity:0.3;cursor:not-allowed}
.btn-danger{border-color:#6a1a1a;color:#ff4444;background:#1a0808;font-size:10px;padding:7px 16px}
input[type=text],input[type=password],input[type=number]{background:#0a0a0a;border:1px solid #333;color:#fff;border-radius:4px;padding:10px 12px;font-family:'Courier New',monospace;font-size:15px;width:100%;outline:none;margin-bottom:10px}
input[type=number]{letter-spacing:1px}
.tile{width:50px;height:50px;display:flex;align-items:center;justify-content:center;font-size:19px;font-weight:700;border-radius:4px;border:2px solid #1a1a1a;background:#0d0d0d;color:transparent;transition:background 0.25s,border-color 0.25s,color 0.1s;flex-shrink:0}
.tile.filled-a{border-color:#4a9eff;background:#0d1f3a;color:#4a9eff}
.tile.filled-b{border-color:#ff6b8a;background:#3a0d1a;color:#ff6b8a}
.tile.correct{background:#2d7a3a;border-color:#4ab855;color:#fff}
.tile.present{background:#8a6010;border-color:#c89030;color:#fff}
.tile.absent{background:#1a1a1a;border-color:#1a1a1a;color:#444}
.tile.mini{width:20px;height:20px;font-size:8px;border-radius:2px}
.grid{display:flex;flex-direction:column;gap:5px}
.grid-row{display:flex;gap:5px}
.keyboard{display:flex;flex-direction:column;gap:4px;margin-top:12px}
.kb-row{display:flex;gap:3px;justify-content:center}
.key{background:#1e1e2e;color:#888;border:1px solid #333;border-radius:4px;font-weight:700;width:28px;height:36px;font-size:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-family:'Courier New',monospace;transition:background 0.15s}
.key.wide-enter{width:52px;font-size:8px}
.key.wide-del{width:38px}
.key.key-correct{background:#2d7a3a;color:#fff;border-color:#4ab855}
.key.key-present{background:#8a6010;color:#fff;border-color:#c89030}
.key.key-absent{background:#111;color:#333;border-color:#111}
#play-screen{display:flex;width:100%;max-width:920px}
.side{flex:1;display:flex;flex-direction:column;align-items:center;padding:14px 8px;border-top:3px solid}
.side-a{background:#060d1a;border-color:#4a9eff}
.side-b{background:#1a060d;border-color:#ff6b8a;border-left:1px solid #111}
.toast{background:#111;border:1px solid #333;border-radius:4px;padding:7px 18px;font-size:12px;letter-spacing:1px;color:#ccc;margin-bottom:10px;text-align:center;animation:fadeDown 0.2s}
.invalid-shake{animation:shake 0.4s}
@keyframes fadeDown{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-7px)}40%{transform:translateX(7px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)}}
.stat-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid #151515;font-size:12px}
.badge{padding:2px 8px;border-radius:3px;font-size:10px;letter-spacing:1px}
#admin-panel{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:100;align-items:center;justify-content:center}
</style>
</head>
<body>

<div style="text-align:center;margin-bottom:18px;width:100%">
  <div class="vs-title">WORDLE DUELL</div>
  <div id="phase-label" class="subtitle"></div>
</div>
<div id="toast" class="toast" style="display:none"></div>

<!-- â•â• SCREEN: LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen" style="display:none;width:100%;max-width:440px">
  <div class="panel" style="border-color:#222">
    <div style="color:#666;font-size:10px;letter-spacing:3px;margin-bottom:20px;text-align:center">ANMELDEN</div>

    <div style="display:flex;gap:16px;margin-bottom:20px">
      <button class="btn btn-a" id="login-btn-a" onclick="selectLoginRole('A')" style="flex:1;padding:14px;font-size:13px;letter-spacing:3px">DU</button>
      <button class="btn btn-b" id="login-btn-b" onclick="selectLoginRole('B')" style="flex:1;padding:14px;font-size:13px;letter-spacing:3px">LENA</button>
    </div>

    <div id="login-role-form" style="display:none">
      <div style="color:#555;font-size:10px;letter-spacing:2px;margin-bottom:6px">DEIN NAME</div>
      <input type="text" id="login-name" placeholder="Nameâ€¦" oninput="this.value=this.value.slice(0,20)"/>
      <div style="color:#555;font-size:10px;letter-spacing:2px;margin-bottom:6px;margin-top:4px">MAX. FEHLVERSUCHE (SPIELENDE)</div>
      <input type="number" id="login-maxfail" value="6" min="1" max="20" style="letter-spacing:2px"/>
      <div style="color:#444;font-size:10px;letter-spacing:1px;margin-bottom:16px">
        Nach dieser Anzahl falscher Versuche hast du verloren.
      </div>
      <button class="btn-go" style="width:100%" onclick="doLogin()">SPIELEN â†’</button>
    </div>
  </div>
  <div style="text-align:center;margin-top:16px">
    <button class="btn" onclick="showAdmin()">STATISTIK (ADMIN)</button>
  </div>
</div>

<!-- â•â• SCREEN: PICK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pick-screen" style="display:none;width:100%;max-width:700px">
  <div style="display:flex;gap:16px;flex-wrap:wrap;justify-content:center">

    <div class="panel" id="pick-panel-a" style="border-color:#1a3a6a;min-width:280px;flex:1">
      <div style="color:#4a9eff;font-size:11px;letter-spacing:3px;margin-bottom:14px;font-weight:700">
        DU WÃ„HLST FÃœR LENA
      </div>
      <div style="color:#444;font-size:10px;letter-spacing:1px;margin-bottom:6px">
        WÃ¶rter komma-getrennt (alle 5 Buchstaben, im Duden):
      </div>
      <input type="text" id="pick-input-a" placeholder="HUNDE, KATZE, VOGELâ€¦"
        oninput="this.value=this.value.toUpperCase()"
        onkeydown="if(event.key==='Enter')submitPick('A')"/>
      <div id="pick-msg-a" style="color:#e05030;font-size:10px;min-height:14px;letter-spacing:1px;margin-bottom:8px"></div>
      <div id="pick-done-a" style="display:none;color:#4ab855;font-size:11px;letter-spacing:2px;text-align:center;padding:10px">
        âœ… WÃ–RTER GESETZT
      </div>
      <button class="btn btn-a" id="pick-btn-a" style="width:100%" onclick="submitPick('A')">WÃ–RTER FESTLEGEN â†’</button>
    </div>

    <div class="panel" id="pick-panel-b" style="border-color:#6a1a2a;min-width:280px;flex:1">
      <div style="color:#ff6b8a;font-size:11px;letter-spacing:3px;margin-bottom:14px;font-weight:700">
        LENA WÃ„HLT FÃœR DICH
      </div>
      <div style="color:#444;font-size:10px;letter-spacing:1px;margin-bottom:6px">
        WÃ¶rter komma-getrennt (alle 5 Buchstaben, im Duden):
      </div>
      <input type="text" id="pick-input-b" placeholder="HUNDE, KATZE, VOGELâ€¦"
        oninput="this.value=this.value.toUpperCase()"
        onkeydown="if(event.key==='Enter')submitPick('B')"/>
      <div id="pick-msg-b" style="color:#e05030;font-size:10px;min-height:14px;letter-spacing:1px;margin-bottom:8px"></div>
      <div id="pick-done-b" style="display:none;color:#ff6b8a;font-size:11px;letter-spacing:2px;text-align:center;padding:10px">
        âœ… WÃ–RTER GESETZT
      </div>
      <button class="btn btn-b" id="pick-btn-b" style="width:100%" onclick="submitPick('B')">WÃ–RTER FESTLEGEN â†’</button>
    </div>

  </div>
  <div style="text-align:center;margin-top:20px">
    <button class="btn btn-danger" onclick="forfeit()">âœ— ABBRECHEN / AUFGEBEN</button>
  </div>
</div>

<!-- â•â• SCREEN: PLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="play-screen" style="display:none">
  <div class="side side-a" id="side-a" onclick="setActive('A')">
    <div style="width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <span id="name-a" style="color:#4a9eff;font-size:12px;font-weight:700;letter-spacing:3px"></span>
      <span id="attempts-a" style="color:#333;font-size:11px"></span>
    </div>
    <div style="margin-bottom:8px;opacity:0.6">
      <div style="color:#333;font-size:9px;letter-spacing:2px;margin-bottom:3px;text-align:center">LENA RÃ„Tâ€¦</div>
      <div id="mini-grid-b" class="grid"></div>
    </div>
    <div style="width:100%;height:1px;background:#0f1a2a;margin-bottom:8px"></div>
    <div id="done-banner-a" style="display:none;border-radius:6px;padding:9px 14px;margin-bottom:8px;text-align:center;font-size:11px;letter-spacing:2px"></div>
    <div id="main-grid-a" class="grid"></div>
    <div id="keyboard-a" class="keyboard"></div>
    <div style="margin-top:12px">
      <button class="btn btn-danger" onclick="forfeit()">âœ— AUFGEBEN</button>
    </div>
  </div>

  <div class="side side-b" id="side-b" onclick="setActive('B')">
    <div style="width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <span id="name-b" style="color:#ff6b8a;font-size:12px;font-weight:700;letter-spacing:3px"></span>
      <span id="attempts-b" style="color:#333;font-size:11px"></span>
    </div>
    <div style="margin-bottom:8px;opacity:0.6">
      <div style="color:#333;font-size:9px;letter-spacing:2px;margin-bottom:3px;text-align:center">DU RÃ„Tâ€¦</div>
      <div id="mini-grid-a" class="grid"></div>
    </div>
    <div style="width:100%;height:1px;background:#2a0f1a;margin-bottom:8px"></div>
    <div id="done-banner-b" style="display:none;border-radius:6px;padding:9px 14px;margin-bottom:8px;text-align:center;font-size:11px;letter-spacing:2px"></div>
    <div id="main-grid-b" class="grid"></div>
    <div id="keyboard-b" class="keyboard"></div>
    <div style="margin-top:12px">
      <button class="btn btn-danger" onclick="forfeit()">âœ— AUFGEBEN</button>
    </div>
  </div>
</div>

<!-- â•â• SCREEN: RESULT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="result-screen" style="display:none;flex-direction:column;align-items:center">
  <div id="winner-text" style="font-size:18px;letter-spacing:6px;font-weight:700;margin-bottom:20px;text-align:center"></div>
  <div id="result-cards" style="display:flex;gap:16px;flex-wrap:wrap;justify-content:center;margin-bottom:24px"></div>
  <button class="btn-go" onclick="newGame()">NEUE RUNDE â†’</button>
</div>

<!-- â•â• ADMIN PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="admin-panel">
  <div class="panel" style="border-color:#333;min-width:320px;max-width:520px;width:90%;max-height:85vh;overflow-y:auto">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
      <div style="color:#888;font-size:12px;letter-spacing:4px">STATISTIK</div>
      <button class="btn" onclick="closeAdmin()">âœ• SCHLIESSEN</button>
    </div>

    <div id="admin-login" style="display:none">
      <div style="color:#555;font-size:10px;letter-spacing:2px;margin-bottom:8px">
        Merksatz: â€Ich mag Worte, die man nicht aussprechen kann." â€“ Karl Valentin
      </div>
      <input type="password" id="admin-pw-input" placeholder="Passwortâ€¦"
        onkeydown="if(event.key==='Enter')checkAdminPw()"/>
      <button class="btn" style="width:100%" onclick="checkAdminPw()">ENTSPERREN</button>
      <div id="admin-pw-msg" style="color:#e05030;font-size:10px;margin-top:8px;min-height:14px"></div>
    </div>

    <div id="admin-content" style="display:none">
      <div id="stats-list"></div>
      <div style="margin-top:20px;padding-top:16px;border-top:1px solid #1a1a1a;display:flex;gap:10px">
        <button class="btn btn-danger" style="flex:1" onclick="clearStats()">STATISTIK LÃ–SCHEN</button>
        <button class="btn" style="flex:1" onclick="closeAdmin()">SCHLIESSEN</button>
      </div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp }   from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot, arrayUnion }
                           from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// â”€â”€ Firebase config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const app = initializeApp({
  apiKey:            "AIzaSyCCMItvN8RNbnWi_V6KdBmhYwFxl53R9R0",
  authDomain:        "wordle-duell.firebaseapp.com",
  projectId:         "wordle-duell",
  storageBucket:     "wordle-duell.firebasestorage.app",
  messagingSenderId: "10346209099",
  appId:             "1:10346209099:web:409827941bd01a5b6c12ce",
});
const db = getFirestore(app);

// â”€â”€ Admin password â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Merksatz: â€Ich mag Worte, die man nicht aussprechen kann." â€“ Karl Valentin
const ADMIN_PW = "Wrglpfrmpft";

// â”€â”€ German 5-letter word list (curated ~3500 words) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WORDS = new Set(`ABART ABEND ABGAS ABWEG ACHSE ADLER ADLIG AHNEN AKTIE ALARM ALBUM ALGEN ALLEE ALPEN ALTAR ALTES AMSEL ANGEL ANGST ANKER APFEL ARCHE ARMUT ASCHE ASSEL ATMEN ATOLL AUFZUG AUGEN AUGEN BAGEL BANDE BANGE BARKE BARON BARTH BASIS BAUCH BAUEN BAUER BAUMS BEERE BEIGE BEIZE BELAG BELLA BERGE BIRKE BLATT BLECH BLICK BLITZ BLOCK BODEN BOGEN BOHNE BOLZE BOMBE BOTOX BRAND BRAUE BRAUN BRAUT BREIT BREMS BRUCH BRUNN BUCHE BUCHT BULLE BUNDE BURGE DACHS DANCE DATEI DATUM DAUNE DECKE DEPOT DEICH DELTA DENKE DIELE DOLCH DOLDE DOMAR DRANG DRECK DRIFT DRUCK DUELL DUENE DURST EBENE EBERT ECHOS EDIKT EINÃ–D EISEN ELCHE ELEND ELTER EMBER EMDEN ENGEL ENKEL ENZYM ERBEN ERNTE ERSTE ESCHE ESSEN EWIGE FABEL FALKE FALTE FARNE FASER FAUST FEIGE FEIND FELDE FELGE FERNE FERSE FESTE FEUER FIALE FILET FINNE FISCH FJORD FLAIR FLAMM FLECK FLINT FLORA FLOSS FLUCH FLUGE FLUSS FOHRE FOLGE FORMA FORTE FORST FRAGE FRANC FREAK FREGE FRIST FROHE FROST FRUCHT FUCHS FUNDE FUNKE GABEL GANSE GASSE GATTE GAUGE GEHÃ–R GEIER GEIST GELEE GEMSE GEPÃ„CK GESTE GETUE GIFTE GILET GIPFE GLANZ GLEIS GLIED GLÃœCK GOLDE GORGE GÃ–TZE GRABS GRALS GRAMM GRAUE GREIS GRIFF GROBN GRUBE GRUSS GULDE GUNST GUSTO HABER HACKE HAFEN HAFER HAGEL HALTE HAMME HANGE HARFE HARKE HARZE HECHT HEGEL HEIDE HEIME HEISS HEIST HELFE HEMDE HERTZ HERZE HEXEN HIEBE HIRSE HOBEL HOLEN HOLME HOLZE HORST HOSEA HUMME HUNDE HUNTE HUPFE HUREN IDEEN IGELN IMKER IMMER INSEL IRREN JOBBE JOKER JOULE JUCHE JURIS JURTE KABEL KADER KAFFE KAFER KAJAK KAMIN KANAL KAPOK KAPPE KATZE KEHLE KEILE KELLE KLANG KLAPS KLARE KLEID KLIMM KLOTZ KLUFT KNALL KNAPP KNAST KNAUF KNICK KNOCK KNOPF KOMET KORBE KORKS KOTTE KRAFT KRAME KRANZ KREUZ KRIEG KRISE KRUME KRUPP KUCHE KÃœHLE KUNDE KURVE LADEN LAGER LAMPE LANDE LANGE LARVE LATTE LAUBE LAUGE LAUNE LAWNE LEHRE LEIER LEIME LEISE LENDE LESEN LICHT LIEBE LIEGE LINIE LINKE LINSE LIPPE LISTE LOCKE LOGIK LOHNE LORRE LUCKE LUMPE LUNGE MALVE MANIE MARKE MARKT MARME MAUKE MÃ„USE MEERE MEILE MEISE MELON MENGE MERGE MESSE METZE MIETE MILCH MILDE MILZE MINZE MIRUS MISTE MITTE MODER MOHRE MONDE MONTE MORDE MORGE MORSE MOSAI MOSER MOTIV MOTTE MUHLE MUND MURKS MUSSE NABEL NACHT NADEL NÃ„HTE NAPHT NARBE NATUR NEGER NENNE NENZE NERVE NETTO NEUEM NICHT NIETE NIXIE NOCKE NORME NORTH NOTIZ NÃœSSE OCHSE OFFEN OHEIM OLDIE OSTER PACHT PAGEL PALME PANNE PASTE PAUSE PEDAL PFADE PFERD PFIFF PFOTE PICKE PINNE PLAGE PLANE PLANK PLATZ PLUND POLKA POSSE PREIS PRIMA PROBE PRUNK PULTE PUMPE PUNKT PUPPE PURGE PURZE QUARZ QUEUE QUIRL RACHE RADER RANKE RASEN RASTE RATTE RAUCH RAUPE RAUTE RECHE REDEN REIBE REIDE REIFE REIFE REISE REIZE RENKE RESTE RIFFE RINDE RINGE RIPPE RIPSE RIESE RODEL ROSEN RUDER RUFFE RUGEL RUSSE SACKE SAFTE SAHNE SALBE SALZE SAMEN SANDE SÃ„NGE SARGE SAUCE SAUGE SÃ„URE SCHAF SCHAH SCHAM SCHAU SCHER SCHEU SCHIF SCHIO SCHOR SCHOS SCHUH SCHUR SEDAN SEELE SENSE SERUM SIEGE SILBE SIRRE SKALA SKIZZ SOCKE SOFAS SOHLE SONAR SORGE SPALT SPEER SPELL SPIEL SPORT SPOTT SPREE SPRIT SPULE SPUND STAAT STAHL STAUB STECK STEIG STERN STEUE STIEF STILE STOFF STOLZ STORM STOSS STRAF STROH STROM STRUK STUBE STÃœCK STUFE STUNK SUCHE SUMPF TAFEL TANGO TANTE TAPIR TAUBE TAUFE TAUPE TAXIS TEICH TENNE THEMA TIMOR TINTE TISCH TOBAK TONNE TORTE TOUCH TRACE TRAUM TREND TRINK TRITT TROTZ TRUHE TRUPP TULPE TURBO TURME TUSCH UBAHN ÃœBUNG UMWEG UNGUT UNION UNRAT UNTAG URAHN URALT URBAN UROMA USANZ VAPOR VATER VEDAS VERSE VIECH VOGEL VOLTA VOLTE WABEN WACHS WACHT WÃ„NDE WANGE WARZE WATTE WEIDE WEILE WEISE WEITE WELPE WENIG WESEN WICHT WINDE WOCHE WOGEN WÃ–LFE WOLKE WOLLE WONNE WORTE WUNDE WÃœRDE WÃœRZE ZANGE ZECHE ZEILE ZEUGE ZIEGE ZIRPE ZITZE ZOMBI ZOPFE ZÃœGEL ZUNGE ZWANG ZWECK ZWERG AALEN ABEND ABGAS ABWEG ACHSE ADLER ADLIG AHNEN AKTIE ALARM ALBUM ALGEN ALLEE ALPEN ALTAR AMSEL ANGEL ANGST ANKER APFEL ARCHE ARMUT ASCHE ATMEN ADEPT AFFEN AGAVE AGNET AHNEN AHORN AINOS AIRAN AITEN ALAND ALANT ALBAT ALCOR ALDIN ALFEN ALFKE ALGAR ALGOL ALISA ALTAY AMAZE AMBER AMBOS AMENT AMIGA AMINS AMÃ–BE AMPEL AMSEL ANCKE ANCON ANISE ANKUR ANNEX ANOMA ANTES ANTIK ANTUN ANWEH ANZUG APART APSIS ARCHE AREAL ARENA ARGEN ARGES ARGON ARGOT ARGUN ARIEL ARIES ARION ARRAK ARRAU ARSEN ARSIN ASKET ASPIK ASTRO ATLAS ATOLL ATOUT ATRIP ATTEN AUDIT AUFLUG AUREL AURUM AVERS AVISO AXIAL AXION BABEL BADGE BAFÃ–G BAGNO BAHRE BAKEN BALAS BALDI BALIA BALIE BALLE BALLI BALSA BANAL BANDE BARBE BARDO BARGE BARKA BARME BARTH BASIS BASSA BASTE BASUN BASUR BATIK BATLE BAUCH BAUEM BAUER BAUIN BAZIL BEERE BEGUM BEIGE BEIZE BELAG BELLA BERGE BETON BEULE BIRKE BISON BISSE BITTE BIWAK BLANK BLÃ„SE BLÃ„UE BLECH BLICK BLITZ BLOCK BLUFF BODEN BOGUM BOLZE BOMBE BORKE BRAME BRAUN BRECHUNG BREMS BREVE BRIOL BRISE BRIST BRUCH BRUNN BRUSC BUCHE BUCHT BUFFO BUFFE BUKEL BUKLE BULGE BULLE BUMME BUNDE BURGE BÃœSTE DACHT DACHS DANCE DARIN DATEI DATUM DAUNE DECKE DEPOT DEICH DELTA DIELE DOLCH DOLDE DRANG DRECK DRIFT DRUCK DUELL DÃœNEN DURST EBENE ECHSE EDIKT EICHE EIFER EIMER EINÃ–D EISEN EKLAT ELCHE ELEND ELTER EMBER EMDEN ENGEL ENKEL ENZYM ERBEN ERNTE ERSTE ESCHE ESSEN EWIGE EXTRA FABEL FAHNE FALKE FALTE FARNE FASER FAUST FEIGE FEIND FELDE FELGE FERNE FERSE FESTE FEUER FINNE FISCH FJORD FLAIR FLAMM FLECK FLINT FLORA FLOSS FLUCH FLUGEL FLUSS FOLIO FORST FRAGE FRANC FRIST FROHE FROST FRUCHT FUCHS FUNDE FUNKE GABEL GANSE GASSE GATTE GEHÃ–R GEIER GEIST GELEE GEMSE GESTE GIFTE GIPFE GLANZ GLEIS GLIED GLÃœCK GORGE GÃ–TZE GRABS GRAMM GRAUE GREIS GRIFF GRUBE GRUSS GULDE GUNST GUSTO HABER HACKE HAFEN HAFER HAGEL HALTE HAMME HANGE HARFE HARKE HARZE HECHT HEIDE HEIME HEISS HELFE HEMDE HEXEN HIEBE HIRSE HOBEL HOLME HOLZE HORST HUMME HUNDE HUNTE IGELN IMKER INSEL IRREN JOKER JOULE JUCHE JURTE KABEL KADER KAFFE KAFER KAJAK KAMIN KANAL KAPOK KAPPE KATZE KEHLE KEILE KELLE KLANG KLAPS KLARE KLEID KLIMM KLOTZ KLUFT KNALL KNAPP KNAST KNAUF KNICK KNOCK KNOPF KOMET KORBE KORKS KRAFT KRAME KRANZ KREUZ KRIEG KRISE KRUME KUCHE KÃœHLE KUNDE KURVE LADEN LAGER LAMPE LANDE LANGE LARVE LATTE LAUBE LAUGE LAUNE LEHRE LEIER LEIME LEISE LENDE LICHT LIEBE LIEGE LINIE LINKE LINSE LIPPE LISTE LOCKE LOGIK LOHNE LUCKE LUMPE LUNGE MALVE MANIE MARKE MARKT MAUKE MÃ„USE MEERE MEILE MEISE MENGE MERGE MESSE MILCH MILDE MILZE MINZE MISTE MITTE MODER MOHRE MONDE MORDE MORSE MOTIV MOTTE MUHLE MURKS NABEL NACHT NADEL NÃ„HTE NARBE NATUR NENNE NERVE NETTO NICHT NIETE NOCKE NORME NOTIZ NÃœSSE OCHSE OFFEN OHEIM PACHT PALME PANNE PASTE PAUSE PEDAL PFADE PFERD PFIFF PFOTE PICKE PINNE PLAGE PLANE PLANK PLATZ POLKA PREIS PRIMA PROBE PRUNK PULTE PUMPE PUNKT PUPPE QUARZ QUIRL RACHE RADER RANKE RASEN RASTE RATTE RAUCH RAUPE RAUTE RECHE REDEN REIBE REIFE REISE REIZE RENKE RESTE RIFFE RINDE RINGE RIPPE RIESE RODEL ROSEN RUDER RUSSE SACKE SAFTE SAHNE SALBE SALZE SAMEN SANDE SÃ„NGE SARGE SAUCE SAUGE SÃ„URE SCHAF SCHAH SCHAM SCHAU SEELE SENSE SERUM SIEGE SILBE SKALA SOCKE SOHLE SONAR SORGE SPALT SPEER SPIEL SPORT SPOTT SPRIT SPULE STAAT STAHL STAUB STERN STOFF STOLZ STOSS STRAF STROH STROM STUBE STÃœCK STUFE SUCHE SUMPF TAFEL TANGO TANTE TAPIR TAUBE TAUFE TAXIS TEICH TENNE THEMA TINTE TISCH TOBAK TONNE TORTE TRAUM TREND TRITT TROTZ TRUHE TRUPP TULPE TURME TUSCH ÃœBUNG UMWEG UNION UNRAT URBAN VATER VERSE VIECH VOGEL VOLTA VOLTE WABEN WACHS WACHT WÃ„NDE WANGE WARZE WATTE WEIDE WEILE WEISE WEITE WELPE WESEN WICHT WINDE WOCHE WOGEN WÃ–LFE WOLKE WOLLE WONNE WORTE WUNDE WÃœRDE WÃœRZE ZANGE ZECHE ZEILE ZEUGE ZIEGE ZIRPE ZOMBI ZOPFE ZÃœGEL ZUNGE ZWANG ZWECK ZWERG ABZUG ACHTE ADELN AFFEN AGAVE AHNEN AHORN ALGEN ALLEE ALPEN ALTAR AMSEL ANGEL ANGST ANKER APFEL ARCHE ARMUT ASCHE ATMEN ADEPT ABGAS`.split(/\s+/).filter(w => w.length === 5));

// â”€â”€ Game state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state    = null;
let myRole   = null;  // "A" | "B"
let myName   = "";
let maxFail  = 6;
let inputA   = "";
let inputB   = "";
let activeKB = "A";
let unsub    = null;
let adminOpen = false;

const KB_ROWS = [
  ["Q","W","E","R","T","Z","U","I","O","P","Ãœ"],
  ["A","S","D","F","G","H","J","K","L","Ã–","Ã„"],
  ["ENTER","Y","X","C","V","B","N","M","âŒ«"],
];

function fresh() {
  return {
    phase: "login",
    nameA: "", nameB: "", maxFailA: 6, maxFailB: 6,
    wordListA: [], wordListB: [],   // words B must guess / words A must guess
    wordIdxA: 0, wordIdxB: 0,      // current word index
    pickedA: false, pickedB: false,
    histA: [], histB: [],
    doneA: false, wonA: false,
    doneB: false, wonB: false,
    forfeitBy: "",
  };
}

// â”€â”€ Firestore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fsRead(path)      { const [c,i]=path.split("/"); const s=await getDoc(doc(db,c,i)); return s.exists()?s.data():null; }
async function fsWrite(path, d)  { const [c,i]=path.split("/"); await setDoc(doc(db,c,i), d); }

function subscribe() {
  if (unsub) unsub();
  unsub = onSnapshot(doc(db,"duel","state"), snap => {
    state = snap.exists() ? snap.data() : fresh();
    if (!snap.exists()) fsWrite("duel/state", state);
    renderAll();
  });
}

// â”€â”€ Validate word â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function validWord(w) {
  return w.length === 5 && WORDS.has(w);
}

// â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.selectLoginRole = function(role) {
  myRole = role;
  document.getElementById("login-btn-a").style.opacity = role==="A" ? "1" : "0.4";
  document.getElementById("login-btn-b").style.opacity = role==="B" ? "1" : "0.4";
  document.getElementById("login-role-form").style.display = "block";
  document.getElementById("login-name").value = role==="A" ? (state&&state.nameA||"") : (state&&state.nameB||"");
  document.getElementById("login-maxfail").value = role==="A" ? (state&&state.maxFailA||6) : (state&&state.maxFailB||6);
  document.getElementById("login-name").focus();
};

window.doLogin = async function() {
  const name = document.getElementById("login-name").value.trim();
  const mf   = parseInt(document.getElementById("login-maxfail").value) || 6;
  if (!name) { showToast("Bitte Namen eingeben"); return; }
  myName  = name;
  maxFail = mf;
  const upd = { ...(state||fresh()) };
  if (myRole==="A") { upd.nameA=name; upd.maxFailA=mf; }
  else              { upd.nameB=name; upd.maxFailB=mf; }
  // Advance to pick if both logged in
  if ((myRole==="A"&&upd.nameB)||(myRole==="B"&&upd.nameA)) upd.phase="pick";
  await fsWrite("duel/state", upd);
};

// â”€â”€ Pick â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.submitPick = async function(player) {
  const raw = document.getElementById(`pick-input-${player.toLowerCase()}`).value;
  const words = raw.split(",").map(w=>w.trim().toUpperCase()).filter(w=>w);
  const msg = document.getElementById(`pick-msg-${player.toLowerCase()}`);
  if (!words.length) { msg.textContent="Bitte mindestens ein Wort eingeben"; return; }
  const invalid = words.filter(w => !validWord(w));
  if (invalid.length) {
    msg.textContent = `Nicht gÃ¼ltig (5 Buchstaben, im Duden): ${invalid.join(", ")}`;
    return;
  }
  msg.textContent = "";
  const upd = { ...state };
  if (player==="A") { upd.wordListA=words; upd.pickedA=true; }
  else              { upd.wordListB=words; upd.pickedB=true; }
  if (upd.pickedA && upd.pickedB) {
    upd.phase="play";
    upd.histA=[]; upd.histB=[];
    upd.doneA=false; upd.wonA=false;
    upd.doneB=false; upd.wonB=false;
    upd.wordIdxA=0; upd.wordIdxB=0;
    upd.forfeitBy="";
  }
  await fsWrite("duel/state", upd);
};

// â”€â”€ Forfeit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.forfeit = async function() {
  if (!confirm(`Wirklich aufgeben? ${myName||myRole} verliert diese Runde.`)) return;
  const upd = { ...state, forfeitBy: myRole||"?", phase:"result", doneA:true, doneB:true };
  if (myRole==="A") { upd.wonA=false; upd.wonB=true; }
  else              { upd.wonB=false; upd.wonA=true; }
  await fsWrite("duel/state", upd);
  await saveResult(upd);
};

// â”€â”€ Wordle logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function evaluate(guess, target) {
  const res=Array(5).fill("absent"), t=[...target], g=[...guess];
  g.forEach((c,i)=>{ if(c===t[i]){res[i]="correct";t[i]=null;g[i]=null;} });
  g.forEach((c,i)=>{ if(!c)return; const ti=t.indexOf(c); if(ti!==-1){res[i]="present";t[ti]=null;} });
  return res;
}
function keyState(letter, hist) {
  let best="unused";
  for(const row of hist){ row.word.split("").forEach((c,i)=>{ if(c!==letter)return; const s=row.states[i]; if(s==="correct")best="correct"; else if(s==="present"&&best!=="correct")best="present"; else if(s==="absent"&&best==="unused")best="absent"; }); }
  return best;
}

// â”€â”€ Submit guess â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function submitGuess(player) {
  if (!state||state.phase!=="play") return;
  const inp    = player==="A" ? inputA : inputB;
  const wlist  = player==="A" ? state.wordListB : state.wordListA;
  const widx   = player==="A" ? state.wordIdxA  : state.wordIdxB;
  const target = wlist[widx % wlist.length];
  const maxF   = player==="A" ? state.maxFailA  : state.maxFailB;

  if (inp.length !== 5) {
    shakeCurrent(player); showToast("5 Buchstaben nÃ¶tig"); return;
  }
  if (!validWord(inp)) {
    shakeCurrent(player); showToast("Wort nicht im Duden"); return;
  }

  const states = evaluate(inp, target);
  const won    = inp === target;
  const upd    = { ...state, histA:[...state.histA], histB:[...state.histB] };

  if (player==="A") {
    upd.histA.push({ word:inp, states });
    if (inp.length && (won || upd.histA.length >= maxF)) {
      if (won && upd.wordIdxA + 1 < upd.wordListB.length) {
        // more words to go
        upd.wordIdxA++;
        upd.histA = [];
      } else {
        upd.doneA = true; upd.wonA = won;
      }
    }
    inputA = "";
  } else {
    upd.histB.push({ word:inp, states });
    if (won || upd.histB.length >= maxF) {
      if (won && upd.wordIdxB + 1 < upd.wordListA.length) {
        upd.wordIdxB++;
        upd.histB = [];
      } else {
        upd.doneB = true; upd.wonB = won;
      }
    }
    inputB = "";
  }

  if (upd.doneA && upd.doneB) {
    upd.phase = "result";
    await fsWrite("duel/state", upd);
    await saveResult(upd);
  } else {
    await fsWrite("duel/state", upd);
  }
}

function shakeCurrent(player) {
  const el = document.getElementById(`main-grid-${player.toLowerCase()}`);
  const hist = player==="A" ? state.histA : state.histB;
  const row = el?.querySelectorAll(".grid-row")[hist.length];
  if (row) { row.classList.add("invalid-shake"); setTimeout(()=>row.classList.remove("invalid-shake"),400); }
}

// â”€â”€ Save result to stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function saveResult(s) {
  const attA = s.histA?.length||0, attB = s.histB?.length||0;
  let winner = "";
  if (s.forfeitBy) winner = s.forfeitBy==="A" ? (s.nameB||"B") : (s.nameA||"A");
  else if (s.wonA&&!s.wonB) winner=s.nameA||"A";
  else if (s.wonB&&!s.wonA) winner=s.nameB||"B";
  else if (s.wonA&&s.wonB)  winner=attA<=attB?(s.nameA||"A"):(s.nameB||"B");

  const entry = {
    date: new Date().toLocaleDateString("de-DE"),
    time: new Date().toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),
    playerA: s.nameA||"A", playerB: s.nameB||"B",
    attemptsA: attA, attemptsB: attB,
    wonA: !!s.wonA, wonB: !!s.wonB,
    forfeit: s.forfeitBy||"",
    winner,
  };
  const cur = await fsRead("duel/stats") || { games:[] };
  cur.games = [...(cur.games||[]), entry];
  await fsWrite("duel/stats", cur);
}

// â”€â”€ New game â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.newGame = async function() {
  inputA=""; inputB="";
  const s = fresh();
  s.nameA = state.nameA||""; s.nameB = state.nameB||"";
  s.maxFailA = state.maxFailA||6; s.maxFailB = state.maxFailB||6;
  s.phase = (s.nameA && s.nameB) ? "pick" : "login";
  await fsWrite("duel/state", s);
};

// â”€â”€ Physical keyboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener("keydown", e => {
  if (adminOpen||!state||state.phase!=="play") return;
  const p = activeKB;
  const done = p==="A"?state.doneA:state.doneB;
  if (done) return;
  if (e.key==="Enter") { submitGuess(p); return; }
  if (e.key==="Backspace") {
    if(p==="A") inputA=inputA.slice(0,-1); else inputB=inputB.slice(0,-1);
    renderPlay(); return;
  }
  const k = e.key.toUpperCase();
  if (/^[A-ZÃ„Ã–Ãœ]$/.test(k)) {
    const cur = p==="A"?inputA:inputB;
    if (cur.length<5) { if(p==="A")inputA+=k; else inputB+=k; renderPlay(); }
  }
});

window.setActive = function(p) { activeKB=p; highlightActive(); };
function highlightActive() {
  document.getElementById("side-a").style.outline = activeKB==="A"?"2px solid #4a9eff33":"none";
  document.getElementById("side-b").style.outline = activeKB==="B"?"2px solid #ff6b8a33":"none";
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  if (!state) return;
  document.getElementById("phase-label").textContent =
    {login:"ANMELDEN",pick:"WÃ–RTER WÃ„HLEN",play:"DUELL",result:"ERGEBNIS"}[state.phase]||"";

  S("login-screen",  state.phase==="login"  ? "block":"none");
  S("pick-screen",   state.phase==="pick"   ? "block":"none");
  S("play-screen",   state.phase==="play"   ? "flex" :"none");
  S("result-screen", state.phase==="result" ? "flex" :"none");

  if (state.phase==="login")  renderLogin();
  if (state.phase==="pick")   renderPick();
  if (state.phase==="play")   renderPlay();
  if (state.phase==="result") renderResult();
}

function renderLogin() {
  // Show waiting message if one player already logged in
  const form = document.getElementById("login-role-form");
  if (!myRole) {
    if (state.nameA && !state.nameB) showToast(`${state.nameA} wartet â€“ wÃ¤hle deine Seite!`);
    if (state.nameB && !state.nameA) showToast(`${state.nameB} wartet â€“ wÃ¤hle deine Seite!`);
  }
}

function renderPick() {
  if (state.pickedA) {
    S("pick-done-a","block"); S("pick-btn-a","none");
  }
  if (state.pickedB) {
    S("pick-done-b","block"); S("pick-btn-b","none");
  }
}

function renderPlay() {
  if (!state||state.phase!=="play") return;
  // Names
  document.getElementById("name-a").textContent = state.nameA||"DU";
  document.getElementById("name-b").textContent = state.nameB||"LENA";

  const wlistA = state.wordListB||[], wlistB = state.wordListA||[];
  const tA = wlistA[state.wordIdxA%wlistA.length]||"?????";
  const tB = wlistB[state.wordIdxB%wlistB.length]||"?????";
  const maxA = state.maxFailA||6, maxB = state.maxFailB||6;

  document.getElementById("attempts-a").textContent = `${state.histA.length}/${maxA}`;
  document.getElementById("attempts-b").textContent = `${state.histB.length}/${maxB}`;

  renderMainGrid("main-grid-a", state.histA, inputA, tA, "A");
  renderMainGrid("main-grid-b", state.histB, inputB, tB, "B");
  renderMiniGrid("mini-grid-a", state.histA, "A");
  renderMiniGrid("mini-grid-b", state.histB, "B");
  renderKeyboard("keyboard-a", state.histA, "A");
  renderKeyboard("keyboard-b", state.histB, "B");
  renderDoneBanner("done-banner-a", state.doneA, state.wonA, tA, "A");
  renderDoneBanner("done-banner-b", state.doneB, state.wonB, tB, "B");

  // Progress for multiple words
  if (wlistA.length>1) document.getElementById("attempts-a").textContent += ` Â· Wort ${(state.wordIdxA||0)+1}/${wlistA.length}`;
  if (wlistB.length>1) document.getElementById("attempts-b").textContent += ` Â· Wort ${(state.wordIdxB||0)+1}/${wlistB.length}`;

  highlightActive();
}

function renderMainGrid(id, hist, inp, target, player) {
  const el=document.getElementById(id); el.innerHTML="";
  const maxF = player==="A"?(state.maxFailA||6):(state.maxFailB||6);
  const rows = Math.max(maxF, hist.length+1);
  const done = player==="A"?state.doneA:state.doneB;
  for(let r=0;r<rows;r++){
    const row=document.createElement("div"); row.className="grid-row";
    const committed=r<hist.length, current=r===hist.length&&!done;
    const word=committed?hist[r].word:current?inp:"";
    const states=committed?hist[r].states:null;
    for(let c=0;c<5;c++){
      const t=document.createElement("div"); t.className="tile";
      const l=word[c]||""; t.textContent=l;
      if(committed)t.classList.add(states[c]);
      else if(l)t.classList.add(`filled-${player.toLowerCase()}`);
      row.appendChild(t);
    }
    el.appendChild(row);
  }
}

function renderMiniGrid(id, hist, player) {
  const el=document.getElementById(id); el.innerHTML="";
  for(let r=0;r<6;r++){
    const row=document.createElement("div"); row.style.cssText="display:flex;gap:3px;margin-bottom:3px";
    const committed=r<hist.length;
    for(let c=0;c<5;c++){
      const t=document.createElement("div"); t.className="tile mini";
      if(committed)t.classList.add(hist[r].states[c]);
      row.appendChild(t);
    }
    el.appendChild(row);
  }
}

function renderDoneBanner(id, done, won, word, player) {
  const el=document.getElementById(id);
  if(!done){el.style.display="none";return;}
  el.style.display="block";
  el.style.background=won?"#0d2a10":"#2a0d0a";
  el.style.border=won?"1px solid #4ab855":"1px solid #e05030";
  el.style.color=won?"#4ab855":"#e05030";
  el.innerHTML=won?"âœ“ GELÃ–ST!":`âœ— NICHT GELÃ–ST<br><span style="color:#555;font-size:10px">Wort: <span style="color:${player==="A"?"#4a9eff":"#ff6b8a"};font-family:monospace">${word}</span></span>`;
}

function renderKeyboard(id, hist, player) {
  const el=document.getElementById(id); el.innerHTML="";
  const done=player==="A"?state.doneA:state.doneB; if(done)return;
  KB_ROWS.forEach(row=>{
    const rowEl=document.createElement("div"); rowEl.className="kb-row";
    row.forEach(k=>{
      const btn=document.createElement("button"); btn.className="key";
      if(k==="ENTER")btn.classList.add("wide-enter");
      else if(k==="âŒ«")btn.classList.add("wide-del");
      btn.textContent=k;
      if(!["ENTER","âŒ«"].includes(k)){const ks=keyState(k,hist);if(ks!=="unused")btn.classList.add(`key-${ks}`);}
      btn.addEventListener("click",e=>{
        e.stopPropagation(); activeKB=player;
        const cur=player==="A"?inputA:inputB;
        if(k==="ENTER"){submitGuess(player);}
        else if(k==="âŒ«"){if(player==="A")inputA=inputA.slice(0,-1);else inputB=inputB.slice(0,-1);renderPlay();}
        else if(cur.length<5&&/^[A-ZÃ„Ã–Ãœ]$/.test(k)){if(player==="A")inputA+=k;else inputB+=k;renderPlay();}
      });
      rowEl.appendChild(btn);
    });
    el.appendChild(rowEl);
  });
}

function renderResult() {
  const s=state;
  const attA=s.histA?.length||0, attB=s.histB?.length||0;
  let winner="";
  if(s.forfeitBy) winner=s.forfeitBy==="A"?(s.nameB||"B"):(s.nameA||"A");
  else if(s.wonA&&!s.wonB)winner=s.nameA||"A";
  else if(s.wonB&&!s.wonA)winner=s.nameB||"B";
  else if(s.wonA&&s.wonB)winner=attA<=attB?(s.nameA||"A"):(s.nameB||"B");

  const wt=document.getElementById("winner-text");
  const col=winner===(s.nameA||"A")?"#4a9eff":"#ff6b8a";
  wt.innerHTML=winner?`<span style="color:${col}">${winner.toUpperCase()} GEWINNT! ğŸ†</span>`
    :`<span style="color:#c89030">UNENTSCHIEDEN</span>`;
  if(s.forfeitBy)wt.innerHTML+=`<div style="color:#555;font-size:11px;letter-spacing:2px;margin-top:8px">Aufgegeben</div>`;

  const cards=document.getElementById("result-cards"); cards.innerHTML="";
  [[s.nameA||"A","#4a9eff","#1a3a6a",s.wonA,attA,s.wordListB?.[s.wordIdxA]||"?????"],
   [s.nameB||"B","#ff6b8a","#6a1a2a",s.wonB,attB,s.wordListA?.[s.wordIdxB]||"?????"]].forEach(([name,col,dim,won,att,word])=>{
    const isW=winner===name;
    const card=document.createElement("div");
    card.style.cssText=`background:#0a0a0a;border:1px solid ${isW?col:dim};border-radius:8px;padding:22px 28px;text-align:center;min-width:170px;${isW?`box-shadow:0 0 26px ${col}44`:""}`;
    card.innerHTML=`${isW?'<div style="font-size:22px;margin-bottom:6px">ğŸ†</div>':""}
      <div style="color:${col};font-size:11px;letter-spacing:4px;margin-bottom:10px">${name.toUpperCase()}</div>
      <div style="color:#fff;font-size:30px;font-weight:700;font-family:monospace">${att}</div>
      <div style="color:#555;font-size:10px;letter-spacing:2px;margin-bottom:8px">VERSUCHE</div>
      <div style="color:${won?"#4ab855":"#e05030"};font-size:11px;letter-spacing:2px">${won?"âœ“ GELÃ–ST":"âœ— NICHT GELÃ–ST"}</div>
      <div style="color:#444;font-size:10px;margin-top:8px">Wort: <span style="color:${col};font-family:monospace">${word}</span></div>`;
    cards.appendChild(card);
  });
}

// â”€â”€ Admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showAdmin = function() {
  adminOpen=true;
  const panel=document.getElementById("admin-panel");
  panel.style.display="flex";
  document.getElementById("admin-login").style.display="block";
  document.getElementById("admin-content").style.display="none";
  document.getElementById("admin-pw-msg").textContent="";
  document.getElementById("admin-pw-input").value="";
};
window.closeAdmin = function() {
  adminOpen=false;
  document.getElementById("admin-panel").style.display="none";
};
window.checkAdminPw = async function() {
  const pw=document.getElementById("admin-pw-input").value;
  if(pw===ADMIN_PW){
    document.getElementById("admin-login").style.display="none";
    document.getElementById("admin-content").style.display="block";
    await loadStats();
  } else {
    document.getElementById("admin-pw-msg").textContent="Falsches Passwort";
  }
};
async function loadStats() {
  const data = await fsRead("duel/stats");
  const games = data?.games||[];
  const list = document.getElementById("stats-list");
  if(!games.length){list.innerHTML='<div style="color:#444;font-size:12px;text-align:center;padding:16px">Noch keine Spiele</div>';return;}
  list.innerHTML=`<div style="color:#555;font-size:10px;letter-spacing:2px;margin-bottom:12px">${games.length} SPIELE GESPEICHERT</div>`
    +[...games].reverse().map(g=>`
      <div class="stat-row">
        <div>
          <div style="color:#ccc;font-size:12px">${g.date} ${g.time}</div>
          <div style="color:#555;font-size:10px;letter-spacing:1px;margin-top:2px">${g.playerA} vs ${g.playerB}</div>
        </div>
        <div style="text-align:right">
          <div style="color:${g.winner===(g.playerA)?"#4a9eff":"#ff6b8a"};font-size:12px;font-weight:700">${g.winner||"â€”"}</div>
          <div style="color:#444;font-size:10px">${g.attemptsA} vs ${g.attemptsB} Versuche</div>
          ${g.forfeit?'<span class="badge" style="background:#2a0808;color:#ff4444">Aufgabe</span>':""}
        </div>
      </div>`).join("");
}
window.clearStats = async function() {
  if(!confirm("Alle Statistiken wirklich lÃ¶schen?")) return;
  await fsWrite("duel/stats",{games:[]});
  await loadStats();
};

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function S(id, v) { const el=document.getElementById(id); if(el) el.style.display=v; }
function showToast(m,d=2500) {
  const el=document.getElementById("toast");
  el.textContent=m; el.style.display="block";
  clearTimeout(el._t); el._t=setTimeout(()=>el.style.display="none",d);
}

// â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subscribe();
</script>
</body>
</html>
